{% extends "base.html" %}

{% load static %}

{% block css_files %}


<link rel="stylesheet" href="{% static 'bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'base.css' %}">


<link rel="stylesheet" href="{% static 'home.css' %}">
{% endblock %}

{% block content %}

<div class="container" id="home_body">
	<div  id="filters">
		<div class="mt-3">
			<div class="mb-3">

				<input type="text" class="form-control" id="search_input" placeholder="Search" aria-describedby="text">
				
			</div>

		</div>
		<div>
			<div>
				<select class="form-select" id="sort_select" aria-label="Default select example">
					<option >Sort by</option>
					<option value="name">Name</option>
					<option value="bugs_count">Bugs</option>
					<option value="date_added">Date added</option>
				</select>
			</div>
		</div>
		
	</div>
	<div id="results">
		<table class="table">
			<thead>
				<tr>
					<th scope="col">#</th>
					<th scope="col">Title</th>
					<th scope="col">Bugs</th>
					<th scope="col">Date</th>
				</tr>
			</thead>
			<tbody id="table_body">
				{% for project in projects %}

				<tr>
					<th scope="row"> {{ forloop.counter }}</th>
					<td><a class="a_color">{{ project.name }}</a></td>
					<td>{{ project.bugs_count }}</td>
					<td>{{ project.date_added }}</td>
				</tr>

				{% endfor %}

			</tbody>
		</table>	

		{% if not projects %}
		<div id="no_results_found">no results found</div>
		{% endif %}
	</div>
</div>


<script src="{% static 'JS/jquery.js' %}"></script>
<script src="{% static 'JS/home-js.js' %}"></script>
<script >

  let select =$("#sort_select")


  select.change(function ()
  {
    var method = $("#sort_select").val()
    if (method == "Sort by")return 
    $.ajax(
    {
      url: "{% url 'home' %}",
      type:'GET',

      headers: {"method": method , "ajax":true , "ajaxFunction":"sort"},
      success:function(data)
      {
        
       wrapper = json_to_html(data)

        document.getElementById("table_body").innerHTML =wrapper
         if(wrapper === "")
        {
          document.getElementById("table_body").innerHTML = "no result found"
        }
        

      }
    })
  })

  //search ajax
  let search = $("#search_input")
  search.on('input', function() 
  {
  	var value = search.val()
  	$.ajax(
  	{
  		url:"{% url 'home' %}",
  		type:"GET",
  		headers:{"searchWord":value , "ajax":true , "ajaxFunction":"search" },
  		success :function (data)
  		{
  			 wrapper = json_to_html(data)
  			 document.getElementById("table_body").innerHTML =wrapper
       		  if(wrapper === "")
        		{	
         		 document.getElementById("table_body").innerHTML = "no result found"
        		}
  		}
  	})
  })


 function json_to_html(json_data)
 {
 	try
 	{
 		json_data = JSON.parse(json_data)
 	}catch
 	{
 		return ""
 	}
 	list = []
 	for(let i = 0 ; i< json_data.length ; i++)
 	{
 		list[i] = JSON.parse(json_data[i])
 	}
 	wrapper = ``
 	counter = 1
 	list.forEach((x)=>
 	{
 		wrapper +=`
          <tr>
          <th scope="row"> ${ counter }</th>
          <td ><a class="a_color">${x.name}</a></td>
          <td >${x.bugs_count}</td>
          <td >${x.date}</td>
          </tr> 
          `
          counter ++
 	})

 	return wrapper
 }
</script>

{% endblock %}
